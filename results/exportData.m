function [ data_table ] = exportData( data, filename)
% ========================================================================
% EXPORTDATA exports the data generated by the analysis to a csv
% ========================================================================
% INPUT ARGUMENTS:
%   data                 (matrix) data from analysis
%   filename             (string) location to put csv
% ========================================================================
% OUTPUT:
%   data_table           (table)  contains the formatted data        
% ========================================================================


%% Convert format of data

output = {};

for i = 1:size(data, 1) % for each obs
   
    for year = 1:10
        
        % format original data
        output{end+1, 1}  = year-1;
        output{end, 2}    = data{i, 2};
        output{end, 3}    = data{i, 3};
        
        % add numeric data
        for j = 1:7 
            numeric_data = data{i, year+3}(j);
            if ~any(j==[3,4,5]) % round percents
                output{end, j+3} = round(numeric_data, 6, 'significant');
            else
                output{end, j+3} = round(numeric_data);
            end
        end
        
    end
    
end
    

%% Convert to table
var_names = {'Year', 'Country', 'Crop', 'Percent_Price_Change',         ...
    'Percent_Quantity_Change', 'Welfare_Transfer_to_Producer',          ...
    'Welfare_lost_by_Consumer', 'Welfare_lost_by_Producer',             ...
    'Percent_Change_in_Producer_Surplus',                               ...
    'Percent_Change_in_Consumer_Surplus'};
data_table = cell2table(output, 'VariableNames', var_names);


%% Export table

writetable(data_table, filename)


end

