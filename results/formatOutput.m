function [ data_table ] = formatResults( results_matrix, filtered_data )
% ========================================================================
% FORMATRESULTS converts the results matrix to a readable table
% ========================================================================
% INPUT ARGUMENTS:
%   results_matrix       (matrix)     raw_output generated by running
%                                     analyzeShocksCross
%   filtered_data        (cell array) contains a list of countries and  
%                                     crops each row in the output 
%                                     corresponds to 
% ========================================================================
% OUTPUT:
%   data_table           (table)      contains the formatted data        
% ========================================================================

data = {};

for year = 0:9
   
    for i = 1:size(filtered_data, 1) % for each country and crop result
        
        row = (size(filtered_data, 1)*(year));
        
        country                  = filtered_data{i, 2};
        crop                     = filtered_data{i, 3};
        price_change             = results_matrix(row+i, 1);
        quantity_change          = results_matrix(row+i, 2);
        transfer_to_producer     = results_matrix(row+i, 3);
        consumer_welfare_loss    = results_matrix(row+i, 4);
        producer_welfare_loss    = results_matrix(row+i, 5);
        consumer_surplus_change  = results_matrix(row+i, 6);
        producer_surplus_change  = results_matrix(row+i, 7);
        
        data = [data; {year, country, crop,                             ...
                       price_change, quantity_change,                   ...
                       transfer_to_producer,                            ...
                       consumer_welfare_loss,                           ...
                       producer_welfare_loss,                           ...
                       producer_surplus_change,                         ...
                       consumer_surplus_change}];   

    end
    
end


var_names = {'Year', 'Country', 'Crop', 'Percent_Price_Change',         ...
    'Percent_Quantity_Change', 'Welfare_Transfer_to_Producer',          ...
    'Welfare_lost_by_Consumer', 'Welfare_lost_by_Producer',             ...
    'Percent_Change_in_Producer_Surplus',                               ...
    'Percent_Change_in_Consumer_Surplus'};

data_table = cell2table(data, 'VariableNames', var_names);

end

